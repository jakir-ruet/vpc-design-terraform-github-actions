name: CI-CD Pipeline for Terraform
run-name: ${{github.actor}} has triggreded the pipeline
on:
   push:
      branchs:
         - 'master'

env:
   AWS_ACCESS_KEY: ${{ secrets.AWS_ACCESS_KEY }}
   AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

jobs:
   build-infra:
      name: ci-cd-pipeline-terraform
      run-on: ubuntu-latest
      steps:
         - name: Checkout
           uses: actions/checkout@v2
         - name: Set up Terraform
           uses: hashicorp/setup-terraform@v2
         - name: Terraform Init
           id: init
           run: terraform init
           working-directory: ./terraform
         - name: Terraform validate
           id: validate
           run: terraform validate
           working-directory: ./terraform
         - name: Terraform plan
           id: plan
           run: terraform plan
           working-directory: ./terraform
         - name: Terraform apply
           id: apply
           run: terraform apply
           working-directory: ./terraform
         - name: Terraform destroy
           id: destroy
           run: terraform destroy
           working-directory: ./terraform